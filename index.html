<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#070910">
    <meta name="description" content="Nabu - Speed Reading App">
    <title>Nabu</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.mjs" type="module"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script type="module">
        // Initialize PDF.js worker
        import * as pdfjsLib from 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.min.mjs';
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.0.379/pdf.worker.min.mjs';
        window.pdfjsLib = pdfjsLib;

        // PDF text extraction function
        window.extractPdfText = async function(arrayBuffer) {
            try {
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let fullText = '';
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n';
                }
                return fullText.trim();
            } catch (e) {
                throw new Error('PDF parsing failed: ' + e.message);
            }
        };

        // DOCX text extraction function
        window.extractDocxText = async function(arrayBuffer) {
            try {
                const zip = await JSZip.loadAsync(arrayBuffer);
                const docXml = await zip.file('word/document.xml').async('string');
                // Parse XML and extract text
                const parser = new DOMParser();
                const doc = parser.parseFromString(docXml, 'application/xml');
                const textNodes = doc.getElementsByTagName('w:t');
                let text = '';
                for (let i = 0; i < textNodes.length; i++) {
                    text += textNodes[i].textContent;
                }
                // Add paragraph breaks
                const paragraphs = doc.getElementsByTagName('w:p');
                let result = '';
                for (let i = 0; i < paragraphs.length; i++) {
                    const pTexts = paragraphs[i].getElementsByTagName('w:t');
                    let pText = '';
                    for (let j = 0; j < pTexts.length; j++) {
                        pText += pTexts[j].textContent;
                    }
                    if (pText.trim()) {
                        result += pText.trim() + '\n';
                    }
                }
                return result.trim() || text.trim();
            } catch (e) {
                throw new Error('DOCX parsing failed: ' + e.message);
            }
        };
    </script>
    <link data-trunk rel="css" href="style.css">
    <link data-trunk rel="rust" href="Cargo.toml" data-wasm-opt="z">
</head>
<body>
    <noscript>Nabu requires JavaScript to run.</noscript>
</body>
</html>
